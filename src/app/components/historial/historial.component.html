<div class="">
    <div class="alert alert-primary text-center" role="alert">
        <h5>Historial de pedidos</h5>
    </div>

    <!-- Mostrar la alerta si no hay pedidos -->
    <div *ngIf="!hayPedidosActivos()">
        <div class="alert alert-secondary text-center" role="alert">
            Aún no se han realizado pedidos.
        </div>
    </div>

    <!-- Renderizar los cards si hay pedidos -->
    <ng-container *ngFor="let item of historial; let i = index">
        <div *ngIf="hayPedidosActivosItem(item)" class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center" (click)="togglePanel(i)" style="cursor: pointer;">
                <div>
                    <strong>Pedido: {{ item.fechaPedido | date:'dd/MM/yyyy, HH:mm' }}</strong>
                </div>
                <div>
                    <!-- Total de empanadas sin incluir envío -->
                    <small>
                        <strong>Cantidad de empanadas: {{ calcularTotalEmpanadas(item.pedido) }}</strong> 
                        - <strong>${{ calcularTotalSinEnvio(item) | number }}</strong>
                        <br>
                        <i>+ ${{ item.costoEnvio }} de envío </i>
                    </small>
                    <br>
                    <!-- Total final incluyendo el envío, en una letra más grande -->
                    <strong style="font-size: larger;">Total: ${{ calcularTotalConEnvio(item) | number }}</strong>
                    <i [ngClass]="{'bi-chevron-down': !panelOpenState[i], 'bi-chevron-up': panelOpenState[i]}" class="bi ml-2"></i>
                </div>
            </div>
            

            <div *ngIf="panelOpenState[i]" class="collapse show">
                <div class="card-body">
                    <ng-container *ngFor="let amigo of item.pedido">
                        <!-- Mostrar solo amigos con pedidos -->
                        <div *ngIf="amigo.pedido.length > 0">
                            <h5>{{ amigo.nombre }}</h5>
                            <ul>
                                <li *ngFor="let pedido of amigo.pedido">
                                    {{ pedido.cantidad }} de {{ pedido.gusto }}
                                </li>
                            </ul>
                            <div>
                                <small>Cantidad de empanadas: {{ calcularTotalEmpanadasAmigo(amigo) }}</small> 
                                <br>
                                <small>Costo por unidad: ${{ calcularCostoEmpanadasAmigo(amigo, item) | number }}</small>
                                <br>
                                <small>Costo de envío: ${{ calcularCostoEnvioAmigo(item) | number }}</small>
                                <br>
                                <b><i>Total a pagar: ${{ calcularTotalAmigo(amigo, item) | number }}</i> </b>
                            </div>
                            <hr>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </ng-container>
</div>
